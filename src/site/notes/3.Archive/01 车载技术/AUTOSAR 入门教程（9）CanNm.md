---
{"dg-publish":true,"dg-path":"01 车载技术/AUTOSAR 入门教程（9）CanNm.md","permalink":"/01 车载技术/AUTOSAR 入门教程（9）CanNm/"}
---

#Innolight

🚗 **CAN 网络管理** 是汽车电子系统中确保通信可靠性的关键技术！本文将深入解析 AUTOSAR 中的 **CANNM** 模块如何协调 ECU 的唤醒与睡眠，解决车载网络能耗与通信效率的平衡难题。

## 🌐 网络管理接口：通信系统的智能调度员

**网络管理接口** 是 **ComM** 和总线特定 NM 模块之间的适配层（本文以 **CANNM** 为例）。这个"通信调度中心"有两大核心职能：

![Pasted image 20251230110945.png](/img/user/0.Asset/resource/Pasted%20image%2020251230110945.png)

🔹 **基础功能**  
作为 **总线特定 NM 模块** 与 **ComM 模块** 之间的适配层，其通信接口设计独立于底层总线协议，实现解耦设计。

⚙️ **NM 协调器**  
专为网关 ECU 设计的总线同步关闭机制：
- 仅对唤醒状态（非"**总线睡眠模式**"）的网络进行协调关闭
- 持续监控已睡眠的网络状态
- 当协调集群（**NM 集群**）中任一总线活跃时，保持网络唤醒

💡 协调算法工作流程：
1. 为活跃通道启动 **关闭延迟计时器**
2. 计时器到期 → 释放 NM 网络
3. 所有网络进入"**总线睡眠模式**" → 协调关闭完成

## 🚦 CAN 网络管理：智能睡眠协调系统

**CANNM** 是车载网络的"生物钟"，精准控制着：
- 正常运行模式 ↔ **总线睡眠模式** 的转换
- 网络节点存在性检测
- 集体睡眠状态判断

📡 工作原理：基于周期性 **网络管理 PDU** 的广播通信：
- 接收 PDU → 发送方希望保持网络唤醒
- 准备睡眠的节点停止发送 PDU
- 无 PDU 接收超时 → 触发睡眠模式转换
- 任意节点需要通信 → 发送 PDU 唤醒集群

📌 两大核心机制：
1. **NM 集群** 节点按需发送 NM 消息
2. 总线空闲超时（**CANNM_TIMEOUT_TIME** + **CANNM_WAIT_BUS_SLEEP_TIME**）→ 进入睡眠模式

## 🔄 CANNM 状态机：五大工作状态解析

![Pasted image 20251230111013.png](/img/user/0.Asset/resource/Pasted%20image%2020251230111013.png)

1️⃣ **重复消息状态**  
- 🔄 周期性发送 NM 消息
- ⏱️ 持续至配置计时器到期

2️⃣ **准备睡眠状态**  
- 💤 停止发送 NM 消息
- 🔄 收到 NM 消息则重启超时计时器

3️⃣ **正常状态**  
- 📡 持续发送 NM 消息
- ⏱️ 收发消息均重置计时器

4️⃣ **预备睡眠状态**  
- ⚠️ 配置计时器到期且无通信活动

5️⃣ **总线睡眠状态**  
- 🔋 网络进入低功耗模式
- 🚫 总线无任何通信活动

💡 状态转换逻辑确保了网络资源的高效利用，同时满足实时通信需求！